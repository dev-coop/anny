function Neuron(){this.id=Neuron.count++,this.incoming=[],this.outgoing=[],this.input=0,this.output=0,this.bias=initialize.bias(),this.activationFn=activation.tanh}function Layer(n){var t=this;t.neurons=[],_.times(n,function(){t.neurons.push(new Neuron)})}function Network(){var n=this,t=Array.prototype.slice.call(arguments),i=_.first(t),o=_.last(t),e=_.slice(t,1,t.length-1);n.layers=[],n.input=new Layer(i),n.layers.push(n.input),_.each(e,function(t,i){n.layers.push(new Layer(t))}),n.output=new Layer(o),n.layers.push(n.output),_.each(n.layers,function(t,i){var o=n.layers[i+1];o&&t.connect(o)})}var util={findFastestActivation:function(){var n,t,i,o="10,000,000",e=[],a=Math.random()-.5;console.log("cycles:",o),console.log("value:",a),console.log("----------------");for(var u in activation)t=new Date,_.times(o.replace(/,/g,""),function(){activation[u](a)}),i=new Date-t,e.push({fn:u,ms:i}),console.log(u,i+"ms");return n=_.min(e,"ms"),console.log("----------------"),console.debug(n.fn," @ ",n.ms+"ms"),n}},activation={softplus:function(n){return Math.log(1+Math.exp(n))},tanh:function(n){return 1.7159*Math.tanh(2/3*n)},sigmoid:function(n){return 1/(1+Math.exp(-n))}},initialize={bias:function(){return _.random(-.2,.2)},weight:function(n){var t;return n=n+1||1,t=Math.pow(n,-0.5),_.random(-t,t,!0)}};Neuron.count=0,Neuron.connection=function(n,t,i){return{source:n,target:t,weight:i||initialize.weight(t.incoming.length)}},Neuron.prototype.activate=function(){var n,t=this,i=t.input/(t.incoming.length||1);return t.output=t.activationFn(i),n=t.output+t.bias>0,n&&_.each(t.outgoing,function(n){n.target.input+=t.output*n.weight}),t.output},Neuron.prototype.connect=function(n,t){var i=Neuron.connection(this,n,t);this.outgoing.push(i),n.incoming.push(i)},Layer.prototype.connect=function(n){var t=this;_.each(t.neurons,function(i){var o=t.neurons.length;_.each(n.neurons,function(n){var t=initialize.weight(o);i.connect(n,t)})})},Layer.prototype.activate=function(n){var t=this;_.each(n,function(n,i){var o=t.neurons[i];o.input=n,o.activate()})};
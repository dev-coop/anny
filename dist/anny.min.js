function Neuron(){this.id=Neuron.count++,this.incoming=[],this.outgoing=[],this.input=0,this.output=0,this.bias=initialize.bias(),this.activationFn=activation.tanh}function Layer(t){var n=this;n.neurons=[],_.times(t,function(){n.neurons.push(new Neuron)})}function Network(){var t=this,n=Array.prototype.slice.call(arguments),i=_.first(n),o=_.last(n),e=_.slice(n,1,n.length-1);t.layers=[],t.input=new Layer(i),t.layers.push(t.input),_.each(e,function(n,i){t.layers.push(new Layer(n))}),t.output=new Layer(o),t.layers.push(t.output),_.each(t.layers,function(n,i){var o=t.layers[i+1];o&&n.connect(o)})}var util={findFastestActivation:function(){var t,n,i,o="10,000,000",e=[],u=Math.random()-.5;console.log("cycles:",o),console.log("value:",u),console.log("----------------");for(var a in activation)n=new Date,_.times(o.replace(/,/g,""),function(){activation[a](u)}),i=new Date-n,e.push({fn:a,ms:i}),console.log(a,i+"ms");return t=_.min(e,"ms"),console.log("----------------"),console.debug(t.fn," @ ",t.ms+"ms"),t}},activation={softplus:function(t){return Math.log(1+Math.exp(t))},tanh:function(t){return 1.7159*Math.tanh(2/3*t)},sigmoid:function(t){return 1/(1+Math.exp(-t))}},initialize={bias:function(){return _.random(-.2,.2)},weight:function(t){var n;return t=t+1||1,n=Math.pow(t,-0.5),_.random(-n,n,!0)}};Neuron.count=0,Neuron.connection=function(t,n,i){return{source:t,target:n,weight:i||initialize.weight(n.incoming.length)}},Neuron.prototype.activate=function(t){var n=this,i=n.input/(n.incoming.length||1);return t&&(n.input=t),n.output=n.activationFn(t||i),n.output+n.bias>=0&&_.each(n.outgoing,function(t){t.target.input+=n.output*t.weight}),n.output},Neuron.prototype.connect=function(t,n){var i=Neuron.connection(this,t,n);this.outgoing.push(i),t.incoming.push(i)},Neuron.prototype.receiveInput=function(t,n){var i=Neuron.connection(this,t,n);this.outgoing.push(i),t.incoming.push(i)},Layer.prototype.connect=function(t){var n=this;_.each(n.neurons,function(i){var o=n.neurons.length;_.each(t.neurons,function(t){var n=initialize.weight(o);i.connect(t,n)})})},Layer.prototype.activate=function(t){_.each(this.neurons,function(n,i){n.activate(t?t[i]:void 0)})},Network.prototype.activate=function(t){_.each(this.layers,function(n,i){0===i?n.activate(t):n.activate()})};
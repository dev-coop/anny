function Neuron(){this.id=Neuron.count++,this.incoming=[],this.outgoing=[],this.input=0,this.output=0,this.bias=initialize.bias(),this.activationFn=activation.tanh}function Layer(n){var t=this;t.neurons=[],_.times(n,function(){t.neurons.push(new Neuron)})}function Network(){var n=this,t=Array.prototype.slice.call(arguments),o=_.first(t),i=_.last(t),e=_.slice(t,1,t.length-1);n.layers=[],n.input=new Layer(o),n.layers.push(n.input),_.each(e,function(t,o){n.layers.push(new Layer(t))}),n.output=new Layer(i),n.layers.push(n.output),_.each(n.layers,function(t,o){var i=n.layers[o+1];i&&t.connect(i)})}var util={findFastestActivation:function(){var n,t,o,i="10,000,000",e=[],u=Math.random()-.5;console.log("cycles:",i),console.log("value:",u),console.log("----------------");for(var a in activation)t=new Date,_.times(i.replace(/,/g,""),function(){activation[a](u)}),o=new Date-t,e.push({fn:a,ms:o}),console.log(a,o+"ms");return n=_.min(e,"ms"),console.log("----------------"),console.debug(n.fn," @ ",n.ms+"ms"),n}},activation={softplus:function(n){return Math.log(1+Math.exp(n))},tanh:function(n){return 1.7159*Math.tanh(2/3*n)},sigmoid:function(n){return 1/(1+Math.exp(-n))}},initialize={bias:function(){return _.random(-.2,.2)},weight:function(n){var t;return n=n+1||1,t=Math.pow(n,-0.5),_.random(-t,t,!0)}};Neuron.count=0,Neuron.connection=function(n,t,o){return{source:n,target:t,weight:o||initialize.weight(t.incoming.length)}},Neuron.prototype.activate=function(n){console.log("ni",n);var t=this,o=t.input/(t.incoming.length||1);return n&&(t.input=n),t.output=t.activationFn(n||o),t.output+t.bias>=0&&_.each(t.outgoing,function(n){n.target.input+=t.output*n.weight}),t.output},Neuron.prototype.connect=function(n,t){var o=Neuron.connection(this,n,t);this.outgoing.push(o),n.incoming.push(o)},Neuron.prototype.receiveInput=function(n,t){var o=Neuron.connection(this,n,t);this.outgoing.push(o),n.incoming.push(o)},Layer.prototype.connect=function(n){var t=this;_.each(t.neurons,function(o){var i=t.neurons.length;_.each(n.neurons,function(n){var t=initialize.weight(i);o.connect(n,t)})})},Layer.prototype.activate=function(n){console.log("li"),_.each(this.neurons,function(t,o){t.activate(n?n[o]:void 0)})},Network.prototype.activate=function(n){this.input.activate(n),_.each(this.layers,function(n,t){t>0&&n.activate()})};